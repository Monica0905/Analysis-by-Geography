---
title: "Arrest & Incarceration (adm)_by geo categories in incarceration data"
---


```{r setup, include=FALSE}
# Load packages
require(dplyr)
require(haven)
require(readr)
```

  
  
# Read and merge incarceration and arrest data 
*This chunk does not have to be run if the code is not changed. The data obtained in this chunk have been saved and can be loaded for running the the other chunks.*
```{r}
# Read incarceration data
setwd("O:/Arrest Trends - Phase II/Suburb Analysis/Data")
jail <- read_csv("incarceration_trends.csv")

## Subset to years after 1977
jail <- jail[jail$year >= 1977, ] %>%
  rename(YEAR = year, FIPS = fips)

# Read county level estimated arrest data
#setwd("O:/Arrest Trends - Phase II/Final Data CSV/Estimated Datasets/County Level")
arrest <- read_csv("Final_County_SES_Arrests.csv")

# Merge the two datasets
jail$FIPS <- sprintf("%06d", jail$FIPS) %>%
  substr(2, 6)
jail_arrest <- full_join(arrest, jail, by = c("FIPS", "YEAR"))

# Pick the variables needed
jail_arrest <- jail_arrest %>% 
  select(FIPS, YEAR, COUNTYNAME, FSTATE, REGION,
         total_jail = total_jail_adm, 
         total_arrest = TOTAL_COUNTY_ARRESTS, 
         rate_arrest = TOTAL_COUNTY_ARRESTRATE, 
         pop_jail = total_pop,
         pop_arrest = POP,
         urbanicity,
         UnemploymentRate,
         TOTAL_County_Uninsured,
         Pct_Uninsured,
         TOTAL_County_Poverty,
         Pct_Poverty,
         Median_Household_Inc)

# Convert -99999 to NA
jail_arrest$total_arrest[jail_arrest$total_arrest==-99999] <- NA
jail_arrest$rate_arrest[jail_arrest$rate_arrest==-99999] <- NA
jail_arrest$pop_arrest[jail_arrest$pop_arrest==-99999] <- NA


# Save the data
setwd("O:/Arrest Trends - Phase II/Suburb Analysis/Data")
save(jail_arrest, file = "jail_arrest_county.RData")
```



# Subset data to the four geographical types according to the variable "urbanicity"
```{r}
#setwd("O:/Arrest Trends - Phase II/Suburb Analysis/Data")
setwd("D:/NYU/CAREER/Vera Institute of Justice/Work Materials")
load("jail_arrest_county.RData")

# Rural
rural <- jail_arrest[jail_arrest$urbanicity == "rural", ] %>%
  filter(!is.na(YEAR)) %>%
  as.data.frame()

# Small / Mid
sm <- jail_arrest[jail_arrest$urbanicity == "small/mid", ] %>%
  filter(!is.na(YEAR)) %>%
  as.data.frame()

# Suburban
suburb <- jail_arrest[jail_arrest$urbanicity == "suburban", ] %>%
  filter(!is.na(YEAR)) %>%
  as.data.frame()

# Urban
urban <- jail_arrest[jail_arrest$urbanicity == "urban", ] %>%
  filter(!is.na(YEAR)) %>%
  as.data.frame()


urbanicity <- list(rural, sm, suburb, urban)
```



# Calculate rates

## Source the rate calculation function
```{r}
setwd("D:/NYU/CAREER/Vera Institute of Justice/Work Materials/Analysis-by-Geography/Scripts")
source("Rate Calculation Function.R")
```


# Calculate the rates for each geographical type
```{r}
rates <- list()
for (i in 1:4) {
  rates[[i]] <- cal_rates(urbanicity[[i]])
}

# In 1977 all the jail admission rates are 0, which does not look right.
# In 1978-1980, 2015-2016, either arrest data or incarceration data are missing.
# Remove these years
for (i in 1:4) {
  rates[[i]] <- rates[[i]] %>%
    filter(! (YEAR %in% c(1977:1980, 2015:2016)))
}
```


# Save the rates
```{r}
arrest_jail_rates <- data.frame(YEAR = rates[[1]]$YEAR,
                                arrest_rural = rates[[1]]$rate_arrest, jail_rural = rates[[1]]$rate_jail,
                                arrest_sm = rates[[2]]$rate_arrest, jail_sm = rates[[2]]$rate_jail,
                                arrest_suburb = rates[[3]]$rate_arrest, jail_suburb= rates[[3]]$rate_jail,
                                arrest_urban = rates[[4]]$rate_arrest, jail_urban= rates[[4]]$rate_jail)

setwd("D:/NYU/CAREER/Vera Institute of Justice/Work Materials/Analysis-by-Geography/Data")
write.csv(arrest_jail_rates, file = "Arrest & Jail Adm Rates_All Data.csv", row.names = FALSE)
```


## Plot the incarceration trends
```{r}
color = c("gray30", "coral4", "chartreuse4", "blue4")

#par(mar = c(5, 4, 6, 2) + 0.1, xpd = TRUE)
plot(x = rates[[1]]$YEAR, y = rates[[1]]$rate_jail, type = "l", col = color[1],
     main = "Jail Admission Rate for Different Geographical Types", 
     xlab = "Year", ylab = "Rate", font.lab = 4,
     ylim = c(min(rates[[1]]$rate_jail, rates[[2]]$rate_jail, rates[[3]]$rate_jail, rates[[4]]$rate_jail),
              max(rates[[1]]$rate_jail, rates[[2]]$rate_jail, rates[[3]]$rate_jail, rates[[4]]$rate_jail)))
for (i in 2:4) {
  lines(x = rates[[i]]$YEAR, y = rates[[i]]$rate_jail, type = "l", col = color[i])
}

legend("topleft", col = color, lty = 1, bty = "n", text.width = 5, cex = 1.09, text.font = 3,
       legend = c("rural", "small/mid", "suburban", "urban"))
```